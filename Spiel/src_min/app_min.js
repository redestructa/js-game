var d=!1,e,g,h,i=0,j=[50,500,100,20],k,m=[100,400],n=10,o=4,p=-4,r=d,s=0,t=0,u=!0,v=[],w=[];window.c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};
function x(){g.clearRect(0,0,e.width,e.height);0>o?(y=m[0]-n,z=m[1]):0<o&&(y=m[0]+n-1,z=m[1]);0>p?(A=m[0],C=m[1]-n+1):0<p&&(A=m[0],C=m[1]+n-1);for(var a in h){for(var b=d,f=0;void 0!=w[f];f++)w[f].y<=h[a].y+20&&(w[f].y>=h[a].y&&w[f].x>=h[a].x&&w[f].x<=h[a].x+50)&&(w[f]=w[w.length-1],w.pop(),h[a]=h[h.length-1],h.pop(),b=!0);if(!b){if(h[a].x<=y&&y<=h[a].x+50&&h[a].y<=z&&z<=h[a].y+20)o*=-0.8-Math.random()/2.5;else if(h[a].x<=A&&A<=h[a].x+50&&h[a].y<=C&&C<=h[a].y+20)p*=-0.8-Math.random()/2.5;else continue;
o=2.5>Math.abs(o)?0<=o?2.5:-2.5:o;s+=h[a].a;document.getElementById("lblScore").innerHTML=s;s>t&&(t=b=s,window.localStorage.setItem("highscore",b),document.getElementById("lblHighscore").innerHTML=b);h[a].b&&v.push(h[a].b);h[a]=h[h.length-1];h.pop();break}}for(a=0;a<h.length;a++)b=h[a],g.beginPath(),g.lineWidth=0,g.moveTo(b.x,b.y),g.lineTo(b.x+50,b.y),g.lineTo(b.x+50,b.y+20),g.lineTo(b.x,b.y+20),g.lineTo(b.x,b.y),g.fillStyle=b.color,g.stroke(),g.fill();a=m[0]-j[0];j[0]+=2*i;var b=j[0],f=j[1],l=j[2],
B=j[3];u&&(0==o&&0==p)&&(m[0]=b+a);g.beginPath();g.lineWidth=1;g.moveTo(b,f);g.lineTo(b+l,f);g.lineTo(b+l,f+B);g.lineTo(b,f+B);g.lineTo(b,f);g.fillStyle="#000";g.stroke();g.fill();a=m[0];b=m[1];a+n>=e.width?o*=-1:0>=a-n?o*=-1:b+n>=j[1]&&b+n<=j[1]+j[3]&&a>=j[0]&&a<=j[0]+j[2]?r?(l=h[Math.floor(Math.random()*h.length)],f=l.x+25-m[0],l=l.y+10-m[1],p=5*(-l/l),o=5*(-f/l)):u?o=p=0:p*=-1:0>=b-n?p*=-1:b+n>=e.height&&(m[0]=50,m[1]=400,o*=-1,p*=-1);g.beginPath();g.fillStyle="#3a8";g.arc(a,b,n,0,2*Math.PI,!0);
g.closePath();g.fill();m[0]+=o;m[1]+=p;D();for(var q in v){a=v[q];b=5;g.beginPath();switch(a.type){case 0:b=5;g.fillStyle="#fac";break;case 1:b=15;g.fillStyle="#0a0";break;case 2:b=25,g.fillStyle="#1ca"}g.arc(a.x,a.y,b,0,2*Math.PI,!0);g.closePath();g.fill();a.y+=5}E();for(var F in w)q=w[F],g.beginPath(),g.arc(q.x,q.y,2,0,2*Math.PI,!0),g.closePath(),g.fill(),q.y-=5;window.c(function(){x()})}
function G(a,b){var f=[100,500,1E3],l=Math.floor(Math.random()*f.length);this.x=a;this.y=b;this.a=f[l];this.type=l}function H(a,b,f){switch(a){case 0:this.color="#000";this.a=100;break;case 1:this.color="#f00";this.a=200;break;case 2:this.color="#0f0";this.a=500;break;case 3:this.color="#0ff",this.a=1E3,0.5<=Math.random()&&(this.b=new G(b+25,f+10))}this.x=b;this.y=f}function D(){for(var a in v)if(v[a].y>e.height+100){v[a]=v[v.length-1];v.pop();D();break}}
function E(){for(var a in w)if(null==w[a]||void 0==w[a]||-100>w[a].y){w[a]=w[w.length-1];w.pop();E();break}}var y,z,A,C;
document.addEventListener("DOMContentLoaded",function(){e=document.getElementById("canvas");g=e.getContext("2d");h=[];for(var a=0;50>a;a++){var b=100*Math.random(),f=Math.floor(a/5),l=2*(a%5)+0.5*(f%10);5>b?b=3:15>b?b=2:35>b?b=1:100>b&&(b=0);h[a]=new H(b,52*f+5,22*l+5)}x();t=window.localStorage.getItem("highscore");document.getElementById("lblHighscore").innerHTML=t;window.addEventListener("keydown",function(a){i=0;37==a.keyCode||39==a.keyCode?(i=37==a.keyCode?-5:5,a.preventDefault(),a.stopPropagation(),
k=a.keyCode):32==a.keyCode&&(u&&(p=5,u=d),w.push(new I));window.console.log("keydown: "+a.keyCode)},d);window.addEventListener("keyup",function(a){if(k==a.keyCode&&(37==a.keyCode||39==a.keyCode))i=0},d)},d);function I(){var a=j[1]+j[3]/2;this.x=j[0]+j[2]/2;this.y=a};
